<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Goldman:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="iconfonts/iconfont.css">
  <!-- æ³¨æ„é¡ºåºï¼ -->
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="./css/TopicBox.css">
  

  <title>HomePage</title>

</head>
<body>
  
  <!-- 1.Header -->
  <div class="header">
    <!-- ç‰ˆå¿ƒ -->
    <div class="wrapper">
      <!-- logo -->
      <div class="logo">
        <h1 class="logo-image"><a href="#">name</a></h1>
      </div>
      <!-- å¯¼èˆª -->
      <div class="nav">
        <ul>
          <li><a href="#" class = active>Home</a></li>
          <li><a href="#">Life</a></li>
          <li><a href="#">CS</a></li>
          <li><a href="#">About</a></li>
        </ul>
      </div> 
      <!-- æœç´¢ -->
      <div class="search">
        <input type="text" placeholder="Search">
        <a href="#"></a>
      </div> 
      <!-- ç”¨æˆ· -->
      <div class="user">
        <a href="#">
          <img src="./uploads/user.png" alt=""></a>
      </div> 
    </div>
  </div>

  <!-- 2.Banner -->
   <div class="banner">
    <div class="wrapper">
      <div class="left">
        <ul>
          <li><a href="#">Computer Architecture</a></li>
          <li><a href="#">Web Development</a></li>
          <li><a href="#">Data Structures & Algorithms</a></li>
          <li><a href="#">Artificial Intelligence</a></li>
        </ul>
      </div>
      <div class="right">this is right</div>
    </div>
   </div>

   <!-- recommend
    <div class="recommend wrapper">
      <h3>Tags</h3>
      <ul>
        <li><a href="#">Java</a></li>
        <li><a href="#">Arch</a></li>
        <li><a href="#">JavaScript</a></li>
        <li><a href="#">Web Development</a></li>
        <li><a href="#">React</a></li>
      </ul>
      <a href="#" Class = allTags>More</a>
    </div> -->

  <!-- 3.Blogs_latest -->
  <div class="Blogs_latest wrapper">
    <!-- title -->
    <div class="title">
      <div class="left">
        <h3>Latest</h3>
        <p>Recent blogs </p>
      </div>
      <div class="right">
        <a class="more" href="#">
          <span>More</span>
          <i class="iconfont icon-bug-report"></i>
        </a>
      </div>
    </div>
    <!-- content -->
    <div class="latest-content">
      <ul class="list">
      </ul>
    </div>
  </div>

  <!-- 4.Blogs_topics -->
  <div class="Blogs_topics wrapper">
    <!-- title -->
    <div class="title">
      <div class="left">
        <h3>CS TopicsğŸ’»</h3>
        <p></p>
      </div>
      <div class="right">
        <ul class="titles"> 
          <li data-id="1"><a href="#" data-id="0" class="active">Arch</a></li>
          <li data-id="2"><a href="#" data-id="1">Data Structure & Algorithm</a></li>
          <li data-id="3"><a href="#" data-id="2">Web Development</a></li>
        </ul>
        <a class="more" href="#">
          <span>More</span>
          <i class="iconfont icon-bug-report"></i>
        </a>
      </div>
    </div>
    <!-- content -->
    <div class="topics-content">
      <div class="left"></div>
      <div class="right">
        <ul class="active" data-name="Blog-tipic-1"></ul>
        <ul class="" data-name="Blog-tipic-2"></ul>
        <ul class="" data-name="Blog-tipic-3"></ul>
      </div>
    </div>
  </div>

  <!-- 5.Blogs_Musings -->
  <div class="Blogs_musings wrapper">
    <!-- title -->
    <div class="title">
      <div class="left">
        <h3>Musings</h3>
        <p></p>
      </div>
      <div class="right">
        <a class="more" href="#">
          <span>More</span>
          <i class="iconfont icon-bug-report"></i>
        </a>
      </div>
    </div>
     <!-- content -->
    <div class="content">
      <div class="left">
        <ul>
          <li>1</li>
          <li>2</li>
          <li>3</li>
          <li>4</li>
        </ul>
      </div>
      <div class="right">this is right</div>
    </div>
  </div>

  <!-- 6. Message Wall -->
  <div class="Blogs_message">
    <div class="box w wrapper">
      <div class="box-hd">
        <h3>Your thoughts!ğŸ˜</h3>
        <a href="#"></a>
      </div>
      <div class="box-bd">
        <ul class="clearfix">
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
          <li><a href="#">1</a></li>
        </ul>
      </div>
    </div>
  </div>

     <!-- è¯„è®ºè¾“å…¥åŒº -->
  <div class="mesageinput">
    <div class="wrapper">
      <!-- è¯„è®ºè¾“å…¥åŒº -->
      <div class="input">
        <textarea name="æäº¤åˆ°åç«¯çš„key"  id="txt" placeholder="add a comment"></textarea>
        <button class="button">Submit</button>
      <!-- æç¤ºæ–‡å­—åŒº -->
      </div>
      <div class="hint">
        <span class="total">0/200 words</span>
      </div>
    </div>
  </div>

  <!-- Elevator -->
  <div class="elevator">
    <ul class="list">
      <li><a href="" data-name="latest">Latest</a></li>
      <li><a href="" data-name="topics">CS Topics</a></li>
      <li><a href="#" data-name="musings"> Musings </a></li>
      <li><a href="#" data-name="message"> MesageWall </a></li>
      <li class="top" >
        <a href="#" data-name="top">Top<i class="iconfont icon-bug-report" data-name="top-icon"></i></a>
      </li>
    </ul>
  </div>
  
  <!-- Footer-->
   <div class="footer">
    this is footer
   </div>
   
<!-- script part =========================================================== -->
  <script>
    // Header-hide æ»šåŠ¨å‡ºç°
    (function () {
      const header = document.querySelector('.header')
      const banner = document.querySelector('.banner')
      const header_hide = header.cloneNode(true); // å…‹éš† header
      header_hide.classList.add("header-hide"); // åªæ·»åŠ ç±»ï¼Œä¸æ‰‹åŠ¨è®¾ç½®æ ·å¼
      document.body.appendChild(header_hide);
      window.addEventListener('scroll', function(){
        const n = document.documentElement.scrollTop
        if(n >= banner.offsetTop){
          header_hide.style.top = '0px';
        }else{
          header_hide.style.top = '-60px';
        }
      })
    })();
 /* -------------------------------------------------------------*/
    // Blogs_latest æ¡ä»¶æ¸²æŸ“
  fetch("json/index_latest.json")  // è®¿é—® json ç›®å½•ä¸‹çš„ blogs.json
    .then(response => response.json())  // è§£æ JSON
    .then(data => {
      // console.log("è·å–çš„æ•°æ®:", data);  // æµ‹è¯•æ•°æ®æ˜¯å¦æ­£ç¡®
      renderLatest(data);  // è°ƒç”¨å‡½æ•°æ¸²æŸ“ HTML
    })
    .catch(error => console.error("è·å– JSON å¤±è´¥:", error));
  // æ¸²æŸ“æ•°æ®çš„å‡½æ•°
  function renderLatest(blogs) {
    const blogList = document.querySelector('.Blogs_latest .latest-content ul');
    blogList.innerHTML = ""; // æ¸…ç©ºç°æœ‰å†…å®¹
    blogs.slice(0, 3).forEach(blog => {
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="pic">
          <img src="${blog.pic}" alt="">
          <div class="cover">
            <h2>${blog.title}</h2>
            <p>${blog.date}</p>
          </div>
        </div>
        <div class="txt">
          <div class="left">
            <p>${blog.tag}</p>
          </div>
          <div class="right">
            <p>
              <i class="iconfont icon-commenjson/index_topics_arch.jsont-lines"></i>
              <span>${blog.comments}</span>
            </p>
            <p>
              <i class="iconfont icon-like"></i>
              <span>${blog.likes}</span>
            </p>
          </div>
        </div>
      `;
      blogList.appendChild(li);
    });
  }    
/* -------------------------------------------------------------*/
// Blog_topics æ¡ä»¶æ¸²æŸ“
  const urls = ["json/index_topics_arch.json", 
                "json/index_topics_ds.json",
                "json/index_topics_web.json"]
  const uls = document.querySelectorAll('.Blogs_topics .topics-content .right ul');
  uls.forEach((ul, i) => {
    fetch(urls[i])
      .then(response => response.json())
      .then(data => {
        // console.log(`åŠ è½½æ•°æ® ${i + 1}:`, data);
        renderTopics(data, ul); // ä¼ å…¥å¯¹åº”çš„ `ul`
      })
      .catch(error => console.error("è·å–å¤±è´¥", error));
  });

  // title click
  const titles = document.querySelector('.Blogs_topics .title .right ul')
  titles.addEventListener('click', function(e){
    const uls = document.querySelectorAll('.Blogs_topics .topics-content .right ul')
    if(e.target.tagName === 'A'){
      e.preventDefault(); 

      // tag highlight
      const oldActiveTitle = document.querySelector('.Blogs_topics .title .right li .active')
      console.log(oldActiveTitle);
      if(oldActiveTitle) {
          oldActiveTitle.classList.remove('active')
        }   
      e.target.classList.add('active')

      // tab switch
      const i = +e.target.dataset.id
        // remove 'active'
      const oldActiveContent = document.querySelector('.Blogs_topics .topics-content .right ul.active')
      if(oldActiveContent) {
          oldActiveContent.classList.remove('active')
        }
        // add 'active'
      uls[i].classList.add('active')
    }
  });




// æ¸²æŸ“æ•°æ®function
function renderTopics(blogs, blogList){
  blogList.innerHTML = ""
  blogs.slice(0 ,8).forEach(blog => {
    const li = document.createElement("li");
    li.innerHTML = `
      <div class="father">
        <!-- text -->
        <div class="bottom">
          <div class="text">
            <p class="title">${blog.title}</p>
            <p class="date"> ${blog.date} </p>
            <p class="abstract">${blog.abstract}</p>
          </div>
        </div>
        <!-- image -->
        <div class="image">
          <img src="${blog.pic}" alt="">
        </div>
      </div>
    `;
    blogList.appendChild(li)
  })
}
/* -------------------------------------------------------------*/
    // Elevator 
      // 1.æ»šåŠ¨->å‡ºç°
    (function () {
      const banner = document.querySelector('.banner')
      const elevator = document.querySelector('.elevator')
      window.addEventListener('scroll', function() {
        const n = document.documentElement.scrollTop;
        elevator.style.opacity = n >= banner.offsetTop ? 1 : 0;
      })
    })();
    
      // 2.ç‚¹å‡»äº‹ä»¶
    (function(){
      const list = document.querySelector('.elevator .list')
      const header = document.querySelector('.header')
      list.addEventListener('click', function(e){
        e.preventDefault(); 
        if(e.target.tagName === 'A' || e.target.tagName === 'I'){
          // ç‚¹å‡»->active
          const active_old = document.querySelector('.elevator .list .active')
          if(active_old){
            active_old.classList.remove('active')
          }
          e.target.classList.add('active')
          // ç‚¹å‡»->scroll
          const data_name = e.target.dataset.name
          if(data_name === "top" || data_name === "top-icon"){
            window.scrollTo({top: 0, behavior: "smooth"})
            e.target.classList.remove('active')
          }
          else{
            const data = document.querySelector(`.Blogs_${data_name}`)
            const len = data.getBoundingClientRect().top + window.scrollY - header.offsetHeight;
            window.scrollTo({
              top: len,
              behavior: "smooth"
            });
          }
        }
      })
    })();  
    // 3.æ»‘åŠ¨äº‹ä»¶: é¡µé¢æ»šåŠ¨åˆ°ä¸»é¡µåŒºåŸŸï¼Œelevator <a> -> active
    (function(){
      window.addEventListener('scroll', function(){
        const scrollTop = document.documentElement.scrollTop;
        const header = document.querySelector('.header')
        const bufferSpace = 50
        // Binary search ä¼˜åŒ–: ç›’å­æŒ‰ç…§ offsetTop é¡ºåºæ’åˆ—ï¼Œæ ¹æ® offsetTop æ‰¾åˆ°ç›’å­æ‰§è¡Œæ“ä½œ
        // 3.1. åˆ›å»ºArray: offsetMap=[{name:"data-set", offsetTop:20 },{},{}...]
        const allA = document.querySelectorAll('.elevator .list a')
          // æ ¹æ® <a> æ ‡ç­¾çš„ data-name è·å–ç›’å­å¯¹è±¡
        const offsetMap = Array.from(allA)
          .map(a => {            
            const box = document.querySelector(`.Blogs_${a.dataset.name}`)
            // console.log(a.dataset.name);
            
            return box? {name: a.dataset.name, offsetTop: box.offsetTop - bufferSpace}: null;
          }).filter(Boolean);     
        // 3.2. Binary search: æ ¹æ®å½“å‰scrollTop -> offsetTop æ‰¾åˆ°ç›’å­ï¼Œæ·»åŠ active 
        let left = 0, right = offsetMap.length - 1, activeIndex = 0;
        while(left <= right){
          let mid = Math.floor((left + right) / 2)
          if (scrollTop >= offsetMap[mid].offsetTop - header.offsetHeight ) {
            activeIndex = mid;
            left = mid + 1;
          } else {
            right = mid - 1; 
          }
        }  
        // 3.3. ç§»é™¤æ—§active, æ·»åŠ æ–°active
        const oldActive = document.querySelector('.elevator .list .active')
        if(oldActive) {oldActive.classList.remove('active')}
        allA[activeIndex]?.classList.add('active')
      })
    })();

/* -------------------------------------------------------------*/    
    // Message Input
    const txt = document.querySelector('#txt')
    const hint = document.querySelector('.hint')
    const button = document.querySelector('.input .button')
    // 1. å½“ textarea è·å¾—ç„¦ç‚¹ï¼Œè®© hint æ˜¾ç¤ºå‡ºæ¥
    txt.addEventListener('focus', function(){
      hint.style.opacity = 1;
    })
    // 2. å½“ textarea å¤±ç„¦ï¼Œhint æ¶ˆå¤±
    txt.addEventListener('blur', function(){
      hint.style.opacity = 0;
    })
    // 3. æç¤ºè¾“å…¥å­—æ•°
    txt.addEventListener('input', function(){
      hint.innerHTML = `<span>${txt.value.length}</span>/200 words`
    })
    // 4. å•æœºbutton å‘å¸ƒè¯„è®º, å¹¶æ¸…ç©º textarea
    button.addEventListener('click', function(){
      // TBD 
      if (txt.value.trim() === '') { console.log("invalid message"); }
      else { console.log(txt.value.trim()); }
      txt.value = ''
    })
  </script>
</body>
</html>